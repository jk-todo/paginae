<html>
	<head>
		<script type="text/javascript" charset="utf-8">
		// without ending slash
		function getCurrentHostURL(){
			var href = document.location.href;
			return href.substring( 0, href.indexOf('/', 8) );
		}
	
		// the uncompressed bookmarklet code
		function bookmark(){
			var d=document,
				z=d.createElement('ifr'+'ame'),
				b=d.body;
		
			try{
				if(!b)
					throw(0);
				z.setAttribute('src',getCurrentHostURL() + '/paginae/_design/paginae/saving_iframe.html?url='+window.btoa(window.location.href)+'&title='+window.btoa(window.title));
				b.appendChild(z);
				s=z.style;
				s.position='fixed';
				s.top=s.left=25;
				s.width='7em';
				s.height='3em';
				setTimeout(function(){b.removeChild(z)},3000);
			}catch(e){
				alert('Please%20wait%20until%20the%20page%20has%20loaded.');
			}
		}
	
		/**
		 * @return the compressed bookmarklet code, based on the current host
		 */
		function generateBookmarklet() {
			return "javascript:(function(){var d=document,z=d.createElement('ifr'+'ame'),b=d.body;try{if(!b)throw(0);z.setAttribute('src','" + getCurrentHostURL() + "/paginae/_design/paginae/saving_iframe.html?url='+window.btoa(window.location.href)+'&title='+window.btoa(window.title));b.appendChild(z);s=z.style;s.position='fixed';s.top=s.left=25;s.width='7em';s.height='3em';setTimeout(function(){b.removeChild(z)},3000);}catch(e){alert('Please%20wait%20until%20the%20page%20has%20loaded.');}})();void(0);";
		}
		</script>
		<title>Paginae bookmarklet tester</title>
	</head>

	<body>
		<h1>Paginae bookmarklet tester</h1>
	
		<input type="button" value="Click!" onclick="bookmark();"/>
	
		<h2>Generated bookmarklet</h2>
	
		<p>
			Drag this link : <a>Add to Paginae</a> in your "links" toolbar !
		</p>
	</body>

	<script type="text/javascript" charset="utf-8">
		document.getElementsByTagName('a')[0].href = generateBookmarklet();
	</script>
</html>